<template>
<svg id="_레이어_1" data-name="레이어 1" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 330 102" width="330" height="102">


    <linearGradient id="linear-gradient" x1="201" y1="29" x2="257" y2="29" gradientUnits="userSpaceOnUse">
      <stop offset="0" stop-color="#fff" stop-opacity=".6"/>
      <stop offset="1" stop-color="#000" stop-opacity="0"/>
    </linearGradient>
    <linearGradient id="linear-gradient-2" x1="265" x2="321" xlink:href="#linear-gradient"/>
    <linearGradient id="linear-gradient-3" x1="9" x2="65" xlink:href="#linear-gradient"/>
    <linearGradient id="linear-gradient-4" x1="73" x2="129" xlink:href="#linear-gradient"/>
    <linearGradient id="linear-gradient-5" x1="137" x2="193" xlink:href="#linear-gradient"/>

  <rect class="cls-1" x="201" y="9" width="56" height="40"/>
  <rect class="cls-3" x="265" y="9" width="56" height="40"/>
  <rect class="cls-9" x="9" y="9" width="56" height="40"/>
  <rect class="cls-8" x="73" y="9" width="56" height="40"/>
  <rect class="cls-4" x="137" y="9" width="56" height="40"/>
  <g id="Err5Back">
    <rect class="cls-7" x="8" y="50" width="58" height="44"/>
  </g>
  <g id="Err5Border" class="cls-15">
    <path class="cls-2" d="M66,8v86H8V8h58M67,7H7v88h60V7h0Z"/>
  </g>
  <g id="Err5Ramp">
    <path class="cls-7" d="M49,42v-1.4c0-1.7-1.2-3-2.8-3h-18.5c-1.5,0-2.8,1.3-2.8,3v1.4h24Z"/>
    <path class="cls-7" d="M45.4,21.2c0-1.7-1.1-3.2-2.4-3.2h-12.2c-1.3,0-2.4,1.4-2.4,3.2l-.5,15h7v-9.9c0-.5.3-.8.7-.8h2.9c.4,0,.7.4.7.8v9.9h7l-.5-15Z"/>
  </g>
  <rect id="Err5Back-2" data-name="Err5Back" class="cls-11" x="8" y="72" width="58" height="22"/>
  <text id="Err5Num" class="cls-13" transform="translate(36.5 90.9)"><tspan x="0" y="0" text-anchor="middle">{{ evt.criticalCnt.toFixed(0) }}</tspan></text>
  <g id="Err4Border" class="cls-15">
    <path class="cls-2" d="M130,8v86h-58V8h58M131,7h-60v88h60V7h0Z"/>
  </g>
  <g id="Err4Ramp">
    <path class="cls-6" d="M113,42v-1.4c0-1.7-1.2-3-2.8-3h-18.5c-1.5,0-2.8,1.3-2.8,3v1.4h24Z"/>
    <path class="cls-6" d="M109.4,21.2c0-1.7-1.1-3.2-2.4-3.2h-12.2c-1.3,0-2.4,1.4-2.4,3.2l-.5,15h7v-9.9c0-.5.3-.8.7-.8h2.9c.4,0,.7.4.7.8v9.9h7l-.5-15Z"/>
  </g>
  <g id="Err4Back">
    <rect class="cls-6" x="72" y="50" width="58" height="44"/>
  </g>
  <g id="Err3Back">
    <rect class="cls-5" x="136" y="50" width="58" height="44"/>
  </g>
  <g id="Err2Back">
    <rect class="cls-10" x="200" y="50" width="58" height="44"/>
  </g>
  <g id="Err1Back">
    <rect class="cls-12" x="264" y="50" width="58" height="44"/>
  </g>
  <rect id="Err4Back-2" data-name="Err4Back" class="cls-11" x="72" y="72" width="58" height="22"/>
  <text id="Err4Num" class="cls-13" transform="translate(100.5 90.9)"><tspan x="0" y="0"  text-anchor="middle">{{ evt.majorCnt.toFixed(0) }}</tspan></text>
  <g id="Err3Border" class="cls-15">
    <path class="cls-2" d="M194,8v86h-58V8h58M195,7h-60v88h60V7h0Z"/>
  </g>
  <g id="Err3Ramp">
    <path class="cls-5" d="M177,42v-1.4c0-1.7-1.2-3-2.8-3h-18.5c-1.5,0-2.8,1.3-2.8,3v1.4h24Z"/>
    <path class="cls-5" d="M173.4,21.2c0-1.7-1.1-3.2-2.4-3.2h-12.2c-1.3,0-2.4,1.4-2.4,3.2l-.5,15h7v-9.9c0-.5.3-.8.7-.8h2.9c.4,0,.7.4.7.8v9.9h7l-.5-15Z"/>
  </g>
  <rect id="Err3Back-2" data-name="Err3Back" class="cls-11" x="136" y="72" width="58" height="22"/>
  <text id="Err3Num" class="cls-13" transform="translate(164.5 90.9)"><tspan x="0" y="0" text-anchor="middle">{{ evt.minorCnt.toFixed(0) }}</tspan></text>
  <g id="Err2Border" class="cls-15">
    <path class="cls-2" d="M258,8v86h-58V8h58M259,7h-60v88h60V7h0Z"/>
  </g>
  <g id="Err2Ramp">
    <path class="cls-10" d="M241,42v-1.4c0-1.7-1.2-3-2.8-3h-18.5c-1.5,0-2.8,1.3-2.8,3v1.4h24Z"/>
    <path class="cls-10" d="M237.4,21.2c0-1.7-1.1-3.2-2.4-3.2h-12.2c-1.3,0-2.4,1.4-2.4,3.2l-.5,15h7v-9.9c0-.5.3-.8.7-.8h2.9c.4,0,.7.4.7.8v9.9h7l-.5-15Z"/>
  </g>
  <rect id="Err2Back-2" data-name="Err2Back" class="cls-11" x="200" y="72" width="58" height="22"/>
  <text id="Err2Num" class="cls-13" transform="translate(229.5 90.9)"><tspan x="0" y="0" text-anchor="middle">{{ evt.warningCnt.toFixed(0) }}</tspan></text>
  <g id="Err1Border" class="cls-15">
    <path class="cls-2" d="M322,8v86h-58V8h58M323,7h-60v88h60V7h0Z"/>
  </g>
  <rect id="Err1Back-2" data-name="Err1Back" class="cls-11" x="264" y="72" width="58" height="22"/>
  <text id="Err1Num" class="cls-13" transform="translate(293.5 90.9)"><tspan x="0" y="0" text-anchor="middle">{{ evt.infoCnt.toFixed(0) }}</tspan></text>
  <g id="Err1Ramp">
    <path class="cls-12" d="M305,42v-1.4c0-1.7-1.2-3-2.8-3h-18.5c-1.5,0-2.8,1.3-2.8,3v1.4h24Z"/>
    <path class="cls-12" d="M301.4,21.2c0-1.7-1.1-3.2-2.4-3.2h-12.2c-1.3,0-2.4,1.4-2.4,3.2l-.5,15h7v-9.9c0-.5.3-.8.7-.8h2.9c.4,0,.7.4.7.8v9.9h7l-.5-15Z"/>
  </g>
  <text class="cls-14" transform="translate(23 67.2)"><tspan x="0" y="0">장애</tspan></text>
  <text class="cls-14" transform="translate(87 67.2)"><tspan x="0" y="0">경보</tspan></text>
  <text class="cls-14" transform="translate(151 67.2)"><tspan x="0" y="0">알람</tspan></text>
  <text class="cls-14" transform="translate(215 67.2)"><tspan x="0" y="0">주의</tspan></text>
  <text class="cls-14" transform="translate(279 67.2)"><tspan x="0" y="0">정보</tspan></text>
</svg>
</template>
<script>

import * as d3 from 'd3';
export default {

  methods: {
    refreshData(url, params) {
      
      this.setEvtColor();

      let $this = this
      this.$axios.get(url, {params:params}).then(res => {
        if(res[0] != null){
          /** data 에 선언된 값은 고정! 쿼리에서 조회할 때 맞춰줘야 함 */
          for (const type of Object.keys($this.$data.evt)) {
            //todo  gsap 애니메이션은 데이터가 현재 값에서 변화가 있을 경우 from~to로 동작. 없으면 제자리, 초기화 필요 여부 확인
            $this.evt[type] = 0;

            let info = res[0];
            const params = {
              data: this.$data.evt,
              type: type,
              cnt: info[type]
            };
            this.$store.dispatch('gsap/applyAnimation', params);
          }
        }else{
          this.evt.criticalCnt = 0;
          this.evt.majorCnt = 0;
          this.evt.minorCnt = 0;
          this.evt.warningCnt= 0;
          this.evt.infoCnt = 0;
        }
      })
    },
    /**
     * 패키지 웹에서 설정한 색상으로 표시
     */
    setEvtColor() {
      if(this.isSetColor) return; // 한 번만 적용

      const codeList = this.$store.state.code.codeList
      // svg에 정의된 class - 정보 주의 알람 경보 장애
      const evtClassList = ['.cls-12','.cls-10','.cls-5','.cls-6','.cls-7'] 
      
      evtClassList.forEach((evtClass, idx) => {
        let nodeGroup = d3.selectAll(evtClass)
        for(const node of nodeGroup.nodes()) {
          node.style.fill = codeList['evtLevel' + (idx+1)].codeValue2
        }
      })
      this.isSetColor = true
    }
  },

  filters: {
    toFixed(value) { return value ? value.toFixed(0) : 0 }
  },

  data() {
    return {
      evt: {
        criticalCnt: 0,
        majorCnt: 0,
        minorCnt: 0,
        warningCnt: 0,
        infoCnt: 0,
      },
      isSetColor: false
    }
  }
}
</script>
<style scoped>
      .cls-1 {
        fill: url(#linear-gradient);
      }

      .cls-1, .cls-2, .cls-3, .cls-4, .cls-5, .cls-6, .cls-7, .cls-8, .cls-9, .cls-10, .cls-11, .cls-12 {
        stroke-width: 0px;
      }

      .cls-1, .cls-3, .cls-4, .cls-8, .cls-9, .cls-11 {
        opacity: .2;
      }

      .cls-2 {
        fill: #999;
      }

      .cls-13 {
        font-family: MalgunGothic, 'Malgun Gothic','맑은고딕',Verdana, Helvetica, Sans-Serif;
        font-size: 18px;
      }

      .cls-13, .cls-14 {
        fill: #fff;
      }

      .cls-15 {
        opacity: .5;
      }

      .cls-3 {
        fill: url(#linear-gradient-2);
      }

      .cls-4 {
        fill: url(#linear-gradient-5);
      }

      .cls-5 {
        /* fill: #ffcd00; */
        fill: transparent;
      }

      .cls-6 {
        /* fill: #ff9a00; */
        fill: transparent;
      }

      .cls-7 {
        /* fill: #f64431; */
        fill: transparent;
      }

      .cls-14 {
        font-family: MalgunGothicBold, 'Malgun Gothic, '맑은고딕',Verdana, Helvetica, Sans-Serif';font-weight:bold;
        font-size: 14px;
      }

      .cls-8 {
        fill: url(#linear-gradient-4);
      }

      .cls-9 {
        fill: url(#linear-gradient-3);
      }

      .cls-10 {
        /* fill: #ffe417; */
        fill: transparent;
      }

      .cls-11 {
        fill: #000;
      }

      .cls-12 {
        /* fill: #1428a0; */
        fill: transparent;
      }
    </style>
